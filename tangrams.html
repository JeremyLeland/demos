<link rel='stylesheet' href='./style.css'>

<body>
  <canvas id='canvas' width="800" height="600"></canvas>
</body>

<script type='module'>
  class Edge {
    x1;
    y1;
    x2;
    y2;
    link;
    owner;

    constructor( info ) {
      Object.assign( this, info );
    }

    getTransformed() {
      const cosX = Math.cos( this.owner.angle );
      const sinX = Math.sin( this.owner.angle );
      const cosY = Math.cos( this.owner.angle + Math.PI / 2 );
      const sinY = Math.sin( this.owner.angle + Math.PI / 2 );

      return {
        x1: this.owner.x + cosX * this.x1 + cosY * this.y1,
        y1: this.owner.y + sinX * this.x1 + sinY * this.y1,
        x2: this.owner.x + cosX * this.x2 + cosY * this.y2,
        y2: this.owner.y + sinX * this.x2 + sinY * this.y2,
      };
    }
  }
  
  class Block {
    x = 0;
    y = 0;
    angle = 0;

    #edges = [];

    // TODO: Static functions to create each shape?

    constructor( info ) {
      Object.assign( this, info );

      const size = 100;
      const height = Math.sqrt( 3 ) / 2;

      for ( let i = 0; i < this.points.length; i ++ ) {
        const current = this.points[ i ], next = this.points[ ( i + 1 ) % this.points.length ];

        this.#edges.push( new Edge( { 
          x1: current[ 0 ] * size, 
          y1: current[ 1 ] * size,
          x2: next[ 0 ] * size,
          y2: next[ 1 ] * size,
          owner: this, 
        } ) );
      }
    }

    draw( ctx ) {
      ctx.beginPath();
      this.#edges.forEach( edge => {
        const transformed = edge.getTransformed();

        ctx.lineTo( transformed.x1, transformed.y1 );
        ctx.lineTo( transformed.x2, transformed.y2 );
      } );

      ctx.fillStyle = this.color;
      ctx.fill();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  }

  const HEIGHT = Math.sqrt( 3 ) / 2;

  const BlockInfo = {
    Triangle: {
      points: [ [ 0, -HEIGHT / 2 ], [ 1 / 2, HEIGHT / 2 ], [ -1 / 2, HEIGHT / 2 ] ],
      color: 'green',
    },
    Square: {
      points: [ [ -1/2, -1/2 ], [ 1/2, -1/2 ], [ 1/2, 1/2 ], [ -1/2, 1/2 ] ],
      color: 'orange',
    },
    Diamond: {
      points: [ [ 0, -HEIGHT ], [ 1/2, 0 ], [ 0, HEIGHT ], [ -1/2, 0 ] ],
      color: 'blue',
    },
    ThinDiamond: {
      // TODO: Not quite right width...
      points: [ [ 0, -Math.cos( Math.PI / 12 ) ], [ 1/4, 0 ], [ 0, Math.cos( Math.PI / 12 ) ], [ -1/4, 0 ] ],
      color: 'tan',
    }
  }

  const blocks = [
    new Block( Object.assign( { x: 100, y: 100, angle: 0 }, BlockInfo.Triangle ) ),
    new Block( Object.assign( { x: 100, y: 200, angle: 0 }, BlockInfo.Square ) ),
    new Block( Object.assign( { x: 200, y: 200, angle: Math.PI / 2 }, BlockInfo.Triangle ) ),
    new Block( Object.assign( { x: 175, y: 125, angle: -Math.PI / 4 }, BlockInfo.ThinDiamond ) ),
    new Block( Object.assign( { x: 250, y: 250, angle: -Math.PI / 2 }, BlockInfo.Diamond ) ),
  ];

  const canvas = document.getElementById( 'canvas' );
  const ctx = canvas.getContext( '2d' );

  //ctx.translate( 400, 300 );

  blocks.forEach( block => block.draw( ctx ) );

</script>