<link rel='stylesheet' href='./style.css'>

<style>
  body { background-color: gray;}
</style>

<body>
  <canvas id='canvas' width="800" height="800"></canvas>
</body>

<script type='module'>
  class Edge {
    x1;
    y1;
    x2;
    y2;
    link;
    owner;

    constructor( info ) {
      Object.assign( this, info );
    }

    getTransformed() {
      const cosX = Math.cos( this.owner.angle );
      const sinX = Math.sin( this.owner.angle );
      const cosY = Math.cos( this.owner.angle + Math.PI / 2 );
      const sinY = Math.sin( this.owner.angle + Math.PI / 2 );

      return {
        x1: this.owner.x + cosX * this.x1 + cosY * this.y1,
        y1: this.owner.y + sinX * this.x1 + sinY * this.y1,
        x2: this.owner.x + cosX * this.x2 + cosY * this.y2,
        y2: this.owner.y + sinX * this.x2 + sinY * this.y2,
      };
    }
  }
  
  class Block {
    type;
    x = 0;
    y = 0;
    angle = 0;

    #edges = [];
    #fillStyle;

    constructor( info ) {
      Object.assign( this, info );

      const blockInfo = BlockInfo[ this.type ];
      this.#fillStyle = blockInfo.color;

      const size = 100;
      const points = blockInfo.points;
      for ( let i = 0; i < points.length; i ++ ) {
        const current = points[ i ], next = points[ ( i + 1 ) % points.length ];

        this.#edges.push( new Edge( { 
          x1: current[ 0 ], 
          y1: current[ 1 ],
          x2: next[ 0 ],
          y2: next[ 1 ],
          owner: this, 
        } ) );
      }
    }

    draw( ctx ) {
      ctx.save();

      ctx.translate( this.x, this.y );
      ctx.rotate( this.angle );

      ctx.beginPath();
      this.#edges.forEach( edge => {
        //const transformed = edge.getTransformed();

        ctx.lineTo( edge.x1, edge.y1 );
        ctx.lineTo( edge.x2, edge.y2 );
      } );

      ctx.fillStyle = this.#fillStyle;
      ctx.fill();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 0.02;
      ctx.stroke();

      ctx.restore();
    }
  }

  const HEIGHT = Math.sqrt( 3 ) / 2;

  const BlockInfo = {
    hexagon: {
      points: [ 
        [ -1, 0 ], [ -1/2, -HEIGHT ], [ 1/2, -HEIGHT ], [ 1, 0 ], [ 1/2, HEIGHT ], [ -1/2, HEIGHT ]
      ],
      color: 'yellow',
    },
    trapezoid: {
      points: [ [ -1, HEIGHT / 2 ], [ -1/2, -HEIGHT / 2 ], [ 1/2, -HEIGHT / 2 ], [ 1, HEIGHT / 2 ] ],
      color: 'red',
    },
    diamond: {
      points: [ [ 0, -HEIGHT ], [ 1/2, 0 ], [ 0, HEIGHT ], [ -1/2, 0 ] ],
      color: 'blue',
    },
    triangle: {
      points: [ [ 0, -2 * HEIGHT / 3 ], [ 1/2, HEIGHT / 3 ], [ -1/2, HEIGHT / 3 ] ],
      color: 'green',
    },
    square: {
      points: [ [ -1/2, -1/2 ], [ 1/2, -1/2 ], [ 1/2, 1/2 ], [ -1/2, 1/2 ] ],
      color: 'orange',
    },
    thin: {
      points: [ [ 0, -Math.cos( Math.PI / 12 ) ], [ 1/4, 0 ], [ 0, Math.cos( Math.PI / 12 ) ], [ -1/4, 0 ] ],
      color: 'tan',
    },
  }

  const level = [
    { type: 'hexagon', x: 0, y: 0, angle: 0 },

    { type: 'hexagon', x: -2, y: 0, angle: 0 },
    { type: 'hexagon', x:  2, y: 0, angle: 0 },

    { type: 'triangle', x: -3, y: HEIGHT * -2/3, angle: Math.PI },
    { type: 'triangle', x:  3, y: HEIGHT * -2/3, angle: Math.PI },
    { type: 'triangle', x: -3, y: HEIGHT *  2/3, angle: 0 },
    { type: 'triangle', x:  3, y: HEIGHT *  2/3, angle: 0 },

    { type: 'diamond', x: -1, y: -HEIGHT, angle: 0 },
    { type: 'diamond', x:  1, y: -HEIGHT, angle: 0 },
    { type: 'diamond', x: -1, y:  HEIGHT, angle: 0 },
    { type: 'diamond', x:  1, y:  HEIGHT, angle: 0 },

    { type: 'diamond', x: -3.5, y: 0, angle: 0 },
    { type: 'diamond', x:  3.5, y: 0, angle: 0 },

    {
      type: 'square', 
      x: 3.5 + Math.cos( Math.PI * -1/6 ) * ( HEIGHT/3 + 1/2 ), 
      y: HEIGHT * -1/3 + Math.sin( Math.PI * -1/6 ) * ( HEIGHT/3 + 1/2 ), 
      angle: Math.PI * -1/6
    },
    {
      type: 'square', 
      x: 3.5 + Math.cos( Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      y: HEIGHT * 1/3 + Math.sin( Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      angle: Math.PI / 6
    },
    { type: 'triangle', x: 4 + HEIGHT * 2/3, y: 0, angle: Math.PI / 6 },

    { type: 'trapezoid', x: 0, y: HEIGHT * -3/2, angle: Math.PI },
    { type: 'trapezoid', x: 0, y: HEIGHT *  3/2, angle: 0 },

    { type: 'thin', x: 1.5, y: HEIGHT * 2, angle: Math.PI / 12 },



    { type: 'triangle', x: 0, y: 4, angle: 0 },

    { type: 'square', x: 0, y: 4 + HEIGHT/3 + 1/2, angle: 0 },
    { 
      type: 'square', 
      x: 0 + Math.cos( -Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      y: 4 + Math.sin( -Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      angle: -Math.PI / 6 
    },
    { 
      type: 'square', 
      x: 0 + Math.cos( -5 * Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      y: 4 + Math.sin( -5 * Math.PI / 6 ) * ( HEIGHT/3 + 1/2 ), 
      angle: -5 * Math.PI / 6 
    },
  ];

  const blocks = [];

  level.forEach( block => blocks.push( new Block( block ) ) );

  const canvas = document.getElementById( 'canvas' );
  const ctx = canvas.getContext( '2d' );

  ctx.scale( 80, 80 );
  ctx.translate( 4, 3 );

  blocks.forEach( block => block.draw( ctx ) );

  // For later, if we ever try to save level state in URL
  const levelAscii = JSON.stringify( level );
  const levelBase64 = btoa( levelAscii );

  console.log( levelBase64 );


</script>