<title>Ship Paths</title>
<link rel="stylesheet" href="../grid.css">

<style>
  body {
    width: 100%;
    height: 100%;
  }
  
  #wrapper {
    position: relative;
    aspect-ratio: 1;
    
    min-width: 0%;
    max-width: 100%;
    min-height: 0%;
    max-height: 100%;
    margin: 0 auto;

    background-color: black;
  }

  canvas {
    width: 100%;
    height: 100%;
  }

</style>

<body>
  <div id="wrapper">
    <canvas id="canvas"></canvas>
  </div>
</body>

<script type="module">

  import { Canvas } from '../common/Canvas.js';

  const shipPath = new Path2D();
  shipPath.moveTo( 0.5, 0 );
  shipPath.arc( 0, 0, 0.5, 2.2, -2.2 );
  shipPath.closePath();

  const SIZE = 10;
  
  const ships = [
    {
      type: 'Scout',
      spawnTime: 1000,
      curve: {
        start: { x: 4,   y: 1,   angle: Math.PI / 2 },
        c1:    { x: 4,   y: 2.5, angle: Math.PI / 2 },
        c2:    { x: 2.5, y: 3,   angle: Math.PI     },
        end:   { x: 0,   y: 4,   angle: Math.PI     },
      },
      duration: 2000,
    },
    {
      type: 'Scout',
      spawnTime: 1000,
      curve: {
        start: { x: 5,   y: 1,   angle: Math.PI / 2 },
        c1:    { x: 5,   y: 2.5, angle: Math.PI / 2 },
        c2:    { x: 7.5, y: 3,   angle: 0           },
        end:   { x: 10,  y: 4,   angle: 0           },
      },
      duration: 2000,
    },
  ];

  const canvas = new Canvas( document.getElementById( 'canvas' ) );

  let worldTime = 0;

  canvas.update = ( dt ) => {
    worldTime += dt;
  }

  canvas.draw = ( ctx ) => {
    ctx.scale( 1 / SIZE, 1 / SIZE );

    ctx.clearRect( 0, 0, SIZE, SIZE );

    ships.forEach( ship => {
      const t = ( worldTime - ship.spawnTime ) / ship.duration;

      if ( 0 <= t && t <= 1 ) {   
        const A =     Math.pow( 1 - t, 3 ) * Math.pow( t, 0 );
        const B = 3 * Math.pow( 1 - t, 2 ) * Math.pow( t, 1 );
        const C = 3 * Math.pow( 1 - t, 1 ) * Math.pow( t, 2 );
        const D =     Math.pow( 1 - t, 0 ) * Math.pow( t, 3 );
        
        const c = ship.curve;
        
        const x = A * c.start.x + B * c.c1.x + C * c.c2.x + D * c.end.x;
        const y = A * c.start.y + B * c.c1.y + C * c.c2.y + D * c.end.y;
        const angle = A * c.start.angle + B * c.c1.angle + C * c.c2.angle + D * c.end.angle;
        
        ctx.save();
        ctx.translate( x, y );
        ctx.rotate( angle );
        ctx.fillStyle = 'green';
        ctx.fill( shipPath );
        ctx.restore();
      }
    } );
  }

  canvas.start();

</script>