<title>Hex Grid, highlight under mouse</title>
<link rel="stylesheet" href="../grid.css">

<script type="module">
  import { Canvas } from './Canvas.js';
  import * as Tantrix from './Tantrix.js';

  const SIZE = 16;

  const canvas = new Canvas();

  let mouseX = 0, mouseY = 0;

  canvas.draw = ( ctx ) => {
    // ctx.translate( 0.5, 0.5 );
    ctx.scale( 1 / SIZE, 1 / SIZE );
    
    for ( let row = 0; row < 14; row ++ ) {
      for ( let col = 0; col < 14; col ++ ) {
        const x = Tantrix.gridX( col, row );
        const y = Tantrix.gridY( col, row );
  
        ctx.translate( x, y );
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 1 / SIZE;
        ctx.stroke( Tantrix.HexagonPath );

        ctx.font = '0.4px Arial';
        ctx.textAlign = 'center';
        ctx.shadowColor = 'black';
        ctx.shadowOffsetX = 2;
        ctx.shadowOffsetY = 2;

        ctx.fillStyle = 'white';
        ctx.fillText( `(${ col }, ${ row })`, 0, 0 );

        ctx.translate( -x, -y );
      }
    }

    const halfCol = Math.floor( mouseX * 2 );

    // console.log( `mouseX = ${ mouseX }, halfCol = ${ halfCol } )` );

    ctx.fillStyle = ( ( halfCol - 1 ) % 3 ) == 0 ? '#f00a' : '#00fa';
    ctx.fillRect( 0.5 * halfCol, 0, 0.5, 10 );

    const mouseCol = Math.floor( ( halfCol + 1 ) / 3 );
    const mouseRow = Math.floor( mouseY / Math.sqrt( 3 ) + ( Math.abs( mouseCol + 1 ) % 2 ) / 2 );

    const x = Tantrix.gridX( mouseCol, mouseRow );
    const y = Tantrix.gridY( mouseCol, mouseRow );

    ctx.translate( x, y );
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 1 / SIZE;
    ctx.stroke( Tantrix.HexagonPath );

    ctx.translate( -x, -y );
  }

  canvas.redraw();

  document.addEventListener( 'pointermove', e => {
    mouseX = SIZE * e.clientX / canvas.scale;
    mouseY = SIZE * e.clientY / canvas.scale;
    canvas.redraw();
  } );

</script>