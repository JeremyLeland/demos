<title>Shrink polygons (removing lines as needed)</title>
<link rel="stylesheet" href="../grid.css">

<script type="module">
  import { Canvas } from './Canvas.js';
  import { Line } from './Line.js';

  
  const canvas = new Canvas();

  const SIZE = 10;

  const loop = [
    [ 2, 2 ],
    [ 6, 1 ],
    [ 9, 6 ],
    [ 6, 8.2 ],
    [ 5, 8 ],
    [ 3, 6 ],
  ];

  canvas.draw = ( ctx ) => {
    ctx.scale( 1 / SIZE, 1 / SIZE );
    ctx.lineWidth = 2 * SIZE / canvas.scale;

    for ( let i = 0; i < loop.length; i ++ ) {
      const prev = loop.at( i - 1 );
      const curr = loop[ i ];
      const next = loop[ ( i + 1 ) % loop.length ];
      const next2 = loop[ ( i + 2 ) % loop.length ];

      ctx.beginPath();
      ctx.moveTo( curr[ 0 ], curr[ 1 ] );
      ctx.lineTo( next[ 0 ], next[ 1 ] );
      
      ctx.strokeStyle = 'green';
      ctx.stroke();

      const normalAngle = Math.atan2( curr[ 0 ] - next[ 0 ], next[ 1 ] - curr[ 1 ] );

      const midX = ( curr[ 0 ] + next[ 0 ] ) / 2;
      const midY = ( curr[ 1 ] + next[ 1 ] ) / 2;

      ctx.beginPath();
      ctx.moveTo( midX, midY );
      ctx.lineTo( midX + Math.cos( normalAngle ) * 0.5, midY + Math.sin( normalAngle ) * 0.5 );

      ctx.stroke();

      const prevNormalAngle = Math.atan2( prev[ 0 ] - curr[ 0 ], curr[ 1 ] - prev[ 1 ] );
      const nextNormalAngle = Math.atan2( next[ 0 ] - next2[ 0 ], next2[ 1 ] - next[ 1 ] );

      for ( let scale = 0; scale > -1; scale -= 0.2 ) {
        const ang1 = prevNormalAngle + deltaAngle( prevNormalAngle, normalAngle ) / 2;
        const H1 = scale / Math.cos( deltaAngle( ang1, normalAngle ) );

        const ang2 = normalAngle + deltaAngle( normalAngle, nextNormalAngle ) / 2;
        const H2 = scale / Math.cos( deltaAngle( ang2, nextNormalAngle ) );

        ctx.beginPath();
        ctx.moveTo( curr[ 0 ] + Math.cos( ang1 ) * H1, curr[ 1 ] + Math.sin( ang1 ) * H1 );
        ctx.lineTo( next[ 0 ] + Math.cos( ang2 ) * H2, next[ 1 ] + Math.sin( ang2 ) * H2 );
        
        ctx.strokeStyle = `rgb( ${ 255 + scale * 100 }, ${ 255 + scale * 200 }, 0 )`;
        ctx.stroke();
      }
    }
  };

  canvas.redraw();

  function fixAngle( a ) {
    return a > Math.PI ? a - Math.PI * 2 : a < -Math.PI ? a + Math.PI * 2 : a;
  }

  function deltaAngle( a, b ) {
    return fixAngle( b - a );
  }

  function moo( x1, y1, x2, y2, x3, y3, x4, y4 ) {
    const D = ( y4 - y3 ) * ( x2 - x1 ) - ( x4 - x3 ) * ( y2 - y1 );

    if ( D != 0 ) {
      const uA = ( ( x4 - x3 ) * ( y1 - y3 ) - ( y4 - y3 ) * ( x1 - x3 ) ) / D;

      return uA;
    }
  }

</script>