<title>Draw rocks along walls</title>
<link rel="stylesheet" href="../grid.css">

<script type="module">
  import { Canvas } from './Canvas.js';
  import { Line } from './Line.js';

  
  const canvas = new Canvas();

  const SIZE = 100;

  const level = await ( await fetch( './levels/test1.json' ) ).json();
  
  canvas.draw = ( ctx ) => {
    ctx.scale( 1 / SIZE, 1 / SIZE );
    ctx.lineWidth = 2 * SIZE / canvas.scale;

    ctx.strokeStyle = 'black';
    ctx.fillStyle = 'gray';

    level.forEach( loop => {
      for ( let i = 0; i < loop.length; i ++ ) {
        const curr = loop[ i ];
        const next = loop[ ( i + 1 ) % loop.length ];

        const cx = next[ 0 ] - curr[ 0 ];
        const cy = next[ 1 ] - curr[ 1 ];
        const dist = Math.hypot( cx, cy );
        const angle = Math.atan2( cy, cx );

        const GOAL_SIZE = 1.5;

        let total = 0;

        while ( total < dist ) {
          const segments = Math.ceil( ( dist - total ) / GOAL_SIZE );
          const radius = ( dist - total ) / segments / 2;     // TODO: Add randomness to this somehow?

          const u = ( total + radius ) / dist;

          const x = curr[ 0 ] + u * cx;
          const y = curr[ 1 ] + u * cy;

          ctx.beginPath();
          ctx.ellipse( x, y, radius, 0.5, angle, 0, Math.PI * 2 );
          ctx.fill();
          ctx.stroke();

          total += radius * 2;
        }
      }
    } );
  };

  canvas.redraw();

</script>