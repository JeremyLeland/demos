<title>Single Actor Navigating Hex Maze</title>
<link rel="stylesheet" href="../style.css">

<body></body>

<script type="module">

  import { Game } from '../src/Game.js';
  import { Entity } from '../src/Entity.js';
  import { Cell } from '../src/Cell.js';
  import * as CellGrid from '../src/CellGrid.js';
  import * as Pathfinding from '../src/Pathfinding.js';
  
  class Actor extends Entity {
    size = 10;
    speed = 0.1;

    goal = { x: 0, y: 0, angle: 0 };

    currentCell;
    goalCell;
    path;
    waypoint;

    spawnInCell( cell ) {
      this.currentCell = cell;

      // TODO: Pick random spot on random edge, 
      //       random distance between that spot and center?
      this.x = cell.x;
      this.y = cell.y;
    }

    update( dt ) {
      if ( this.waypoint && Math.hypot( this.waypoint.x - this.x, this.waypoint.y - this.y ) < this.size ) {
        this.waypoint = null;
      }

      if ( this.path && !this.waypoint ) {
        this.path.shift();

        if ( this.path.length > 0 ) {
          this.waypoint = { x: this.path[ 0 ].x, y: this.path[ 0 ].y };
        }
        else {
          this.path = null;
        }
      }

      if ( this.waypoint) {
        this.goal.x = this.waypoint.x;
        this.goal.y = this.waypoint.y;
      }

      this.goal.angle = Math.atan2( this.goal.y - this.y, this.goal.x - this.x );

      this.angle = this.goal.angle;
      this.dx = this.speed * Math.cos( this.angle );
      this.dy = this.speed * Math.sin( this.angle );

      super.update( dt );

      
    }

    drawEntity( ctx ) {
      ctx.fillStyle = 'red';
      ctx.strokeStyle = 'white';
      ctx.fillRect( -this.size, -this.size, this.size * 2, this.size * 2 );
      ctx.strokeRect( -this.size, -this.size, this.size * 2, this.size * 2 );
    }

    draw( ctx ) {
      super.draw( ctx );

      ctx.beginPath();
      ctx.lineTo( this.goalCell.x, this.goalCell.y );
      ctx.lineTo( this.x, this.y );
      ctx.lineWidth = 2;
      ctx.strokeStyle = 'yellow';
      ctx.setLineDash( [ 4, 2 ] );
      ctx.stroke();
      ctx.setLineDash( [] );

      ctx.strokeStyle = 'orange';
      ctx.stroke( Pathfinding.getDrawPath( this.path ) );
    }
  }


  const cellGrid = CellGrid.getHexGrid( 2, 4, 128, 64 );
  CellGrid.doMazeLink( cellGrid[ 0 ][ 0 ] );
  
  

  const actor = new Actor();
  actor.spawnInCell( cellGrid[ 0 ][ 0 ] );
  actor.goalCell = cellGrid[ 0 ][ 1 ];

  actor.path = Pathfinding.getPath( actor.currentCell, actor.goalCell );
  

  const game = new Game();
  game.scroll = { x: 32, y: 32 };

  game.update = ( dt ) => {
    actor.update( dt );
  };

  game.draw = ( ctx ) => {
    for ( let row = 0; row < cellGrid[ 0 ].length; row ++ ) {
      for ( let col = 0; col < cellGrid.length; col ++ ) {
        cellGrid[ col ][ row ].draw( ctx );
      }
    }

    actor.draw( ctx );
  };


</script>