<title>Edge Offset Lines Test</title>
<link rel="stylesheet" href="../../style.css">

<body>
  <canvas id="canvas" width="800px" height="800px"></canvas>
</body>

<script type="module">
  import { Cell } from '../../src/Cell.js';
  import { Line } from '../../src/Line.js';
  import { Curve } from '../../src/Curve.js';

  // const cell = new Cell([
  //   { x: 100, y: 100 },
  //   { x: 100, y: 300 },
  //   { x: 200, y: 300 },
  //   { x: 200, y: 200 },
  //   { x: 200, y: 300 },
  //   { x: 300, y: 300 },
  //   { x: 300, y: 100 },
  // ] );

  const cell = new Cell( [
    { x: 100, y: 100 },
    { x: 200, y: 160 },
    { x: 220, y: 140 },
    { x: 300, y: 100 },
    { x: 200, y: 80 },
  ] );

  const ctx = document.getElementById( 'canvas' ).getContext( '2d' );
  
  cell.draw( ctx );

  ctx.strokeStyle = 'yellow';
  ctx.lineWidth = 1;

  const edge = cell.edges[ 0 ];
  const line = new Line( edge.start.x, edge.start.y, edge.end.x, edge.end.y );

  const numPoints = 28;
  const points = [];
  for ( let i = 0; i < numPoints; i ++ ) {
    const angle = Math.PI * 2 * -i / numPoints;
    const dx = Math.cos( angle );
    const dy = Math.sin( angle );

    let closest = Infinity;
    cell.edges.forEach( edge => {
      const line = new Line( edge.start.x, edge.start.y, edge.end.x, edge.end.y );
      const dist = line.getDistance( cell.x, cell.y, dx, dy );

      if ( 0 < dist && dist < closest ) {
        closest = dist;
      }
    } );

    if ( closest < Infinity ) {
      points.push( {
        x: cell.x + ( dx * closest ),
        y: cell.y + ( dy * closest ),
      } );
    }
  }
  // cell.edges.forEach( edge => points.push( ...edge.getOffsetPoints( 10 ) ) );

  // Cast points from middle to nearest edge, then back off set amount?
  const curves = Curve.getLoopThroughPoints( points );
  curves.forEach( curve => curve.draw( ctx ) );

  ctx.fillStyle = 'lime';
  // ctx.beginPath();
  // points.forEach( p => ctx.lineTo( p.x, p.y ) );
  points.forEach( p => ctx.fillRect( p.x - 1, p.y - 1, 2, 2 ) );
  // ctx.closePath();
  // ctx.stroke();


</script>
