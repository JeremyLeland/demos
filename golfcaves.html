<link rel='stylesheet' href='./style.css'>

<body>
  <canvas id='canvas' width="800" height="1750"></canvas>
</body>

<script type='module'>
  
  const width = 300, height = 200, height_var = 20;

  const points = [];

  for ( let t = 0; t <= 120; t += 0.5 ) {
    points.push( {
      x: width * ( Math.random() - 0.5 ),
      y: height * t + height_var * ( Math.random() - 0.5 ),
    } );
  }

  const curves = getCurvesThroughPoints( points );

  let curveStr = `M ${ curves[ 0 ].start.x } ${ curves[ 0 ].start.y } `;
  curves.forEach( c => 
    curveStr += ` C ${ c.control1.x },${ c.control1.y } ${ c.control2.x },${ c.control2.y } ${ c.end.x },${ c.end.y } `
  );

  const canvas = document.getElementById( 'canvas' );
  const ctx = canvas.getContext( '2d' );

  ctx.translate( 400, 50 );

  const path = new Path2D( curveStr );
  ctx.strokeStyle = 'white';
  ctx.lineWidth = 10;
  ctx.stroke( path );

  ctx.fillStyle = 'red';
  points.forEach( point => {
    ctx.fillRect( point.x - 2, point.y - 2, 4, 4 );
  } );

  // See http://csharphelper.com/blog/2019/04/draw-a-smooth-curve-in-wpf-and-c/
  function getCurvesThroughPoints( points, tension = 0.5 ) {
    const control_scale = tension / 0.5 * 0.175;

    const curves = [];
    
    for ( let i = 0; i < points.length - 1; i ++ )
    {
      const pt_before = points[ Math.max( i - 1, 0 ) ];
      const pt = points[ i ];
      const pt_after = points[ i + 1 ];
      const pt_after2 = points[ Math.min( i + 2, points.length - 1 ) ];

      const p2 = {
        x: pt.x + control_scale * ( pt_after.x - pt_before.x ), 
        y: pt.y + control_scale * ( pt_after.y - pt_before.y ),
      };
      const p3 = { 
        x: pt_after.x - control_scale * ( pt_after2.x - pt.x ), 
        y: pt_after.y - control_scale * ( pt_after2.y - pt.y ),
      };

      curves.push( {
        start: pt,
        control1: p2,
        control2: p3,
        end: pt_after,
      } );
    }

    return curves;
  }

  
</script>