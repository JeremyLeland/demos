<title>Cell Maze Editor</title>
<link rel="stylesheet" href="../style.css">

<body>
  <canvas id="canvas" width="800px" height="800px"></canvas>
</body>

<script type="module">
  import { Cell } from '../src/Cell.js';
  import * as CellGrid from '../src/CellGrid.js';
  
  const width = 900, height = 900;
  const MIN_EDGE_LENGTH = 40;

  const cellGrid = CellGrid.getHexTriangleGrid( 10, 10, 64, 48 );

  for ( let row = 0; row < cellGrid[ 0 ].length; row ++ ) {
    for ( let col = 0; col < cellGrid.length; col ++ ) {
      const cell = cellGrid[ col ][ row ];
      cell.getUnlinkedEdges().forEach( edge => cell.linkTo( edge.neighbor ) );
    }
  }
    
  const ctx = document.getElementById( 'canvas' ).getContext( '2d' );

  draw();

  // TODO: Just get a list of cells, rather than 2D array.
  //       That way, we can more simply remove the item from the list

  document.addEventListener( 'mousedown', ( e ) => {
    const cell = cellUnder( e.clientX, e.clientY );
    if ( cell ) {
      cell.detachAll();

      for ( let row = 0; row < cellGrid[ 0 ].length; row ++ ) {
        for ( let col = 0; col < cellGrid.length; col ++ ) {
          if ( cellGrid[ col ][ row ] == cell ) {
            cellGrid[ col ][ row ] = null;
          }
        }
      }

      draw();
    }
  } );

  function draw() {
    ctx.clearRect( 0, 0, ctx.canvas.width, ctx.canvas.height );

    for ( let row = 0; row < cellGrid[ 0 ].length; row ++ ) {
      for ( let col = 0; col < cellGrid.length; col ++ ) {
        cellGrid[ col ][ row ]?.draw( ctx );
      }
    }
  }

  function cellUnder( x, y ) {
    for ( let row = 0; row < cellGrid[ 0 ].length; row ++ ) {
      for ( let col = 0; col < cellGrid.length; col ++ ) {
        const cell = cellGrid[ col ][ row ];
        if ( cell?.contains( x, y ) ) {
          return cell;
        }
      }
    }
  }

</script>