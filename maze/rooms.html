<title>Rooms</title>
<link rel="stylesheet" href="../style.css">

<body>
  <canvas id="canvas" width="800px" height="800px"></canvas>
</body>

<script type="module">
  import { Curve } from '../src/Curve.js';

  const CELL_SIZE = 64, OFFSET = 32, COLS = 10, ROWS = 10;

  class Cell {
    constructor( NW, NE, SW, SE ) {
      this.NW = NW;
      this.NE = NE;
      this.SW = SW;
      this.SE = SE;
    }
  }

  const cellPoints = Array.from( 
    Array( COLS + 1 ), ( _, col ) => Array.from( 
      Array( ROWS + 1 ), ( _, row ) => ( { 
        x: col * CELL_SIZE + ( Math.random() - 0.5 ) * OFFSET, 
        y: row * CELL_SIZE + ( Math.random() - 0.5 ) * OFFSET,
      } ) 
    )
  );

  const ctx = document.getElementById( 'canvas' ).getContext( '2d' );
  ctx.translate( CELL_SIZE / 2, CELL_SIZE / 2 );
  debugCells( cellPoints );

  const room1 = { NW: cellPoints[ 5 ][ 5 ], NE: cellPoints[ 6 ][ 5 ], SW: cellPoints[ 5 ][ 6 ], SE: cellPoints[ 6 ][ 6 ] };
  const room2 = { NW: cellPoints[ 5 ][ 6 ], NE: cellPoints[ 6 ][ 6 ], SW: cellPoints[ 5 ][ 7 ], SE: cellPoints[ 6 ][ 7 ] };
  const room3 = { NW: cellPoints[ 6 ][ 6 ], NE: cellPoints[ 7 ][ 6 ], SW: cellPoints[ 6 ][ 7 ], SE: cellPoints[ 7 ][ 7 ] };
  
  const roomPoints = [ room1.NW, room1.SW, room1.SE, room1.NE ];

  addRoom( roomPoints, room2 );
  addRoom( roomPoints, room3 );

  const curves = Curve.getLoopThroughPoints( roomPoints );
  curves.forEach( curve => curve.draw( ctx ) );

  function addRoom( combined, room ) {
    const nwIndex = combined.indexOf( room.NW );
    const neIndex = combined.indexOf( room.NE );
    const swIndex = combined.indexOf( room.SW );
    const seIndex = combined.indexOf( room.SE );

    // South
    if ( nwIndex > 0 && neIndex > 0 ) {
      combined.splice( nwIndex + 1, 0, room.SW, room.SE );
    }
    // East
    if ( nwIndex > 0 && swIndex > 0 ) {
      combined.splice( swIndex + 1, 0, room.SE, room.NE );
    }
  }

  function debugCells( cellPoints ) {
    for ( let row = 0; row < ROWS; row ++ ) {
      for ( let col = 0; col < COLS; col ++ ) {
        const NW = cellPoints[ col ][ row ];
        const NE = cellPoints[ col + 1 ][ row ];
        const SW = cellPoints[ col ][ row + 1 ];
        const SE = cellPoints[ col + 1 ][ row + 1 ];
        
        ctx.beginPath();
        [ NW, NE, SE, SW ].forEach( point => {
          ctx.lineTo( point.x, point.y );
        } );
        ctx.closePath();

        ctx.strokeStyle = 'dimgray';
        ctx.stroke();
      }
    }
  }

</script>
