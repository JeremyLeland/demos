<title>Draw Jewels</title>
<link rel="stylesheet" href="../style.css">

<script type="module">


import { Canvas } from '../src/Canvas.js';
import { Board } from '../src/Board.js';


const board = Board.randomBoard();

let selected, moveAxis;
let other;

const canvas = new Canvas();
canvas.backgroundColor = 'tan';
canvas.zoom = 1 / 6;
canvas.scrollX = -0.5;
canvas.scrollY = -0.5;

canvas.draw = ( ctx ) => {
  ctx.lineWidth = 0.002 / canvas.zoom;

  board.draw( ctx );
}

canvas.pointerDown = ( p ) => {
  selected = board.pieces.find( e => Math.hypot( e.x - p.x, e.y - p.y ) < 0.5 );

  canvas.redraw();
}

canvas.pointerMove = ( p ) => {
  if ( p.down && selected ) {
    if ( !moveAxis ) {
      if ( Math.abs( p.dx ) > Math.abs( p.dy ) ) {
        moveAxis = { x: 1, y: 0 };
      }
      else {
        moveAxis = { x: 0, y: 1 };
      }

      const otherX = selected.x + moveAxis.x * Math.sign( p.dx );
      const otherY = selected.y + moveAxis.y * Math.sign( p.dy );

      other = board.pieces.find( e => e.x == otherX && e.y == otherY );
    }

    selected.x += moveAxis.x * p.dx;
    selected.y += moveAxis.y * p.dy;

    other.x -= moveAxis.x * p.dx;
    other.y -= moveAxis.y * p.dy;
  }

  canvas.redraw();
}

canvas.pointerUp = ( p ) => {
  selected.x = Math.round( selected.x );
  selected.y = Math.round( selected.y );

  other.x = Math.round( other.x );
  other.y = Math.round( other.y );

  selected = null;
  moveAxis = null;
  other = null;

  canvas.redraw();
}

canvas.wheelInput = ( p ) => {
  const ZOOM_SPEED = 0.9;
  canvas.zoomAt( p.x, p.y, p.wheel < 0 ? ZOOM_SPEED : 1 / ZOOM_SPEED );
  
  canvas.redraw();
}


</script>