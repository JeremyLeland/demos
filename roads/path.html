<title>Road</title>
<link rel="stylesheet" href="../grid.css">

<canvas id="canvas" width="800px" height="800px"></canvas>

<script type="module">

  import { Curve } from './Curve.js';

  const canvas = document.getElementById( 'canvas' );
  const ctx = canvas.getContext( '2d' );

  const COLS = 5, ROWS = 5, SIZE = 200;

  for ( let r = 0; r < ROWS; r ++ ) {
    for ( let c = 0; c < COLS; c ++ ) {
      ctx.strokeRect( c * SIZE, r * SIZE, SIZE, SIZE );
    }
  }

  const curves = Curve.getCurvesThroughPoints( [
    [ 0, 0 ], [ 0, 1 ], [ 1, 1 ], [ 2, 1 ], [ 2, 0 ], [ 3, 0 ], 
    [ 3, 1 ], [ 3, 2 ], [ 3, 3 ], [ 2, 3 ], [ 2, 2 ], [ 1, 2 ], [ 1, 3 ],
  ].map( e => 
    e.map( i => SIZE * ( i + 0.25 + 0.5 * Math.random() ) ) 
  ) );

  const widths = Array.from( Array( curves.length + 1 ), _ => 20 + 30 * Math.random() );

  const left = [], right = [];

  curves.forEach( ( curve, i ) => {   
    const startWidth = widths[ i ], endWidth = widths[ i + 1 ];
    for ( let t = 0; t <= 1; t += 0.1 ) {
      const pos = curve.getPosition( t );
      const norm = curve.getNormal( t );
      
      const width = startWidth + ( endWidth - startWidth ) * t;
      
      left.push( {
        x: pos[ 0 ] - norm[ 0 ] * width,
        y: pos[ 1 ] - norm[ 1 ] * width,
      } );
      
      right.unshift( {
        x: pos[ 0 ] + norm[ 0 ] * width,
        y: pos[ 1 ] + norm[ 1 ] * width,
      } );
    }
  } );

  const path = new Path2D();

  left.forEach( p => path.lineTo( p.x, p.y ) );
  right.forEach( p => path.lineTo( p.x, p.y ) );

  path.closePath();

  ctx.fillStyle = 'green';
  ctx.fill( path );

</script>